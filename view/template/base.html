{{define "base.html"}}
<!doctype html>
<html lang="pt-br">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>{{ .title }}</title>
		<script src="https://unpkg.com/htmx.org@1.9.6"></script>
		<link rel="stylesheet" href="/static/styles.css">
	</head>
	<body>
		<div class="app-layout">
			<!-- Sidebar -->
			<aside class="sidebar">
				<div class="sidebar-header">
					<h1>Controle de Pagamentos</h1>
				</div>
				<nav class="sidebar-nav">
					<a href="/faturas_natura_centro"
						hx-get="/load_table"
						hx-trigger="click"
						hx-include="#date-from, #date-to, #categoria, #situacao"
						hx-target="#invoice-table-content"
						hx-vals='{"empresa": "natura_centro"}'
						class="nav-link" data-empresa="natura_centro">
						<span class="nav-text">Natura Centro</span>
					</a>
					<a href="/faturas_natura_ara"
						hx-get="/load_table"
						hx-trigger="click"
						hx-include="#date-from, #date-to, #categoria, #situacao"
						hx-target="#invoice-table-content"
						hx-vals='{"empresa": "natura_ara"}'
						class="nav-link" data-empresa="natura_ara">
						<span class="nav-text">Natura Araraquara</span>
					</a>
					<a href="/faturas_natura_xv"
						hx-get="/load_table"
						hx-trigger="click"
						hx-include="#date-from, #date-to, #categoria, #situacao"
						hx-target="#invoice-table-content"
						hx-vals='{"empresa": "natura_xv"}'
						class="nav-link" data-empresa="natura_xv">
						<span class="nav-text">Natura XV</span>
					</a>
					<a href="/faturas_sarracena"
						hx-get="/load_table"
						hx-trigger="click"
						hx-include="#date-from, #date-to, #categoria, #situacao"
						hx-target="#invoice-table-content"
						hx-vals='{"empresa": "sarracena"}'
						class="nav-link" data-empresa="sarracena">
						<span class="nav-text">Sarracena</span>
					</a>
				</nav>
			</aside>
			
			<!-- Main content -->
			<main class="main-content">
			<div>
				<!-- Campo hidden para armazenar a empresa selecionada -->
				<input type="hidden" id="empresa" name="empresa" value="">
				
				<div class="filters">
					<div class="filter-group">
						<label for="date-from">De:</label>
						<input type="date" id="date-from" name="date-from" value="2024-01-01"
							hx-get="/load_table"
							hx-target="#invoice-table-content"
							hx-trigger="change"
							hx-include="#date-from, #date-to, #categoria, #situacao, #empresa">
					</div>
					<div class="filter-group">
						<label for="date-to">Até:</label>
						<input type="date" id="date-to" name="date-to" value="2024-12-31"
							hx-get="/load_table"
							hx-target="#invoice-table-content"
							hx-trigger="change"
							hx-include="#date-from, #date-to, #categoria, #situacao, #empresa">
					</div>
					<div class="filter-group">
						<label for="categoria">Categoria:</label>
						<select id="categoria" name="categoria"
							hx-get="/load_table"
							hx-target="#invoice-table-content"
							hx-trigger="change"
							hx-include="#date-from, #date-to, #categoria, #situacao, #empresa">
							<option value="">Todas</option>
							<option value="Fornecimento">Fornecimento</option>
							<option value="Serviço">Serviço</option>
							<option value="Operacional">Operacional</option>
							<option value="Tecnologia">Tecnologia</option>
							<option value="Financeiro">Financeiro</option>
							<option value="Vendas">Vendas</option>
							<option value="RH">RH</option>
						</select>
					</div>
					<div class="filter-group">
						<label for="situacao">Situação:</label>
						<select id="situacao" name="situacao"
							hx-get="/load_table"
							hx-target="#invoice-table-content"
							hx-trigger="change"
							hx-include="#date-from, #date-to, #categoria, #situacao, #empresa">
							<option value="">Todas</option>
							<option value="Pendente">Pendente</option>
							<option value="Pago">Pago</option>
						</select>
					</div>
					<button class="clear-filters" 
						hx-get="/load_table"
						hx-target="#invoice-table-content"
						hx-include="#date-from, #date-to, #categoria, #situacao, #empresa"
						onclick="document.querySelector('#date-from').value='2024-01-01'; 
						document.querySelector('#date-to').value='2024-12-31'; 
						document.querySelector('#categoria').value=''; 
						document.querySelector('#situacao').value='';">
						Limpar Filtros
					</button>
				</div>
				<div class="table-container">
					<div id="invoice-table-content"
						hx-get="/load_table"
						hx-trigger="load"
						hx-vals='{"empresa": "natura_centro"}'
						>
						<!-- Loading placeholder -->
						<div class="loading">
							<span>⏳ Carregando faturas...</span>
						</div>
					</div>
				</div>
				</div>
			</main>
		</div>
		
		<script>
			// Script para gerenciar a sidebar e navegação
			document.addEventListener('DOMContentLoaded', function() {
				const navLinks = document.querySelectorAll('.nav-link');
				const empresaInput = document.querySelector('#empresa');
				
				// Função para atualizar link ativo
				function updateActiveLink(activeLink) {
					navLinks.forEach(link => link.classList.remove('active'));
					activeLink.classList.add('active');
				}
				
				// Gerenciar cliques nos links da navegação
				navLinks.forEach(link => {
					link.addEventListener('click', function(e) {
						e.preventDefault();
						
						// Atualizar link ativo visualmente
						updateActiveLink(this);
						
						// Extrair empresa do data attribute ou hx-vals
						const empresa = this.dataset.empresa || JSON.parse(this.getAttribute('hx-vals')).empresa;
						if (empresaInput) {
							empresaInput.value = empresa;
						}
						
						// Dispara o evento HTMX
						htmx.trigger(this, 'click');
						
						// Fechar sidebar no mobile após seleção
						if (window.innerWidth <= 768) {
							document.querySelector('.sidebar').classList.remove('open');
						}
					});
				});
				
				// Destacar primeiro link por padrão (opcional)
				if (navLinks.length > 0 && !document.querySelector('.nav-link.active')) {
					updateActiveLink(navLinks[0]);
					const firstEmpresa = navLinks[0].dataset.empresa || JSON.parse(navLinks[0].getAttribute('hx-vals')).empresa;
					if (empresaInput) {
						empresaInput.value = firstEmpresa;
					}
				}
				
				// Toggle para mobile (se você adicionar o botão)
				const menuToggle = document.querySelector('.menu-toggle');
				const sidebar = document.querySelector('.sidebar');
				
				if (menuToggle && sidebar) {
					menuToggle.addEventListener('click', function() {
						sidebar.classList.toggle('open');
					});
					
					// Fechar sidebar ao clicar fora (mobile)
					document.addEventListener('click', function(e) {
						if (window.innerWidth <= 768 && 
							!sidebar.contains(e.target) && 
							!menuToggle.contains(e.target) && 
							sidebar.classList.contains('open')) {
							sidebar.classList.remove('open');
						}
					});
				}
			});
		</script>
	</body>
</html>
{{end}}
